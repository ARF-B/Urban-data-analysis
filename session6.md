داده‌های مربوط به حرکت انسان به‌سادگی قابل‌جمع‌آوری نیستند و معمولاً بر اساس اطلاعات به‌دست‌آمده از دستگاه‌های هوشمند و سیستم‌های موقعیت‌یاب (GPS) هر فرد استخراج می‌شوند. برای استفاده‌های پژوهشی و آموزشی می‌توان از پایگاه داده‌ی Mapbox Movement  بهره گرفت. این وب‌سایت نمونه‌داده‌هایی در زمینه‌ی الگوهای حرکتی ارائه می‌دهد که برای تحلیل اولیه بسیار مناسب‌اند.

 
در این سایت امکان مشاهده‌ی داده‌های روزانه و ماهانه‌ی حرکت و تراکم ترافیک وجود دارد. هریک از مجموعه‌داده‌ها قابل مشاهده، پیش‌نمایش و دانلود هستند. نکته‌ی مهم آن است که داده‌های ارائه‌شده در این بخش، داده‌های خام نیستند؛ بلکه نسخه‌ی پردازش‌شده و خروجی‌شده از داده‌های اصلی محسوب می‌شوند. 

برای دسترسی به داده‌های خام به مجموعه‌ی yjmob100k  نیاز داریم که از طریق وب‌سایت Zenodo  در دسترس است. برای ادامه‌ی کار، لازم است نسخه‌ی دوم این دیتاست را از Zenodo دانلود کنیم.

پس از دانلود مجموعه‌داده‌ها، مرحله‌ی بعدی وارد کردن آن‌ها به محیط تحلیل است. برای این کار از کتابخانه‌ی pandas استفاده می‌کنیم و مسیر فایل را به تابع بارگذاری می‌دهیم. مسیر فایل را می‌توان با کلیک راست روی فایل و انتخاب گزینه‌ی Copy Relative Path دریافت و در کد استفاده کرد.

نکته مهم:در ابتدا کار برای اینکه در روند کار دچار مشکل نشوید باید یک محیط مجازی جدید بسازیر و از همان ابتدا KeplerGL  را نصب کنبد تا در ادامه کار برای نصب آن دچار مشکل نشودید

```python
# Load Data

import pandas as pd

path = r' copy relative path '

df = pd.read_csv(path, compression='gzip')

```



پس از بارگذاری داده‌ها می‌توان با استفاده از دستورات df.shape حجم داده و با اجرای df.head() نمونه‌ای از سطرهای اولیه را مشاهده کرد. از این طریق مشخص می‌شود که حجم داده‌ها بسیار زیاد است و عملاً امکان پردازش مستقیم آن‌ها در محیط GIS وجود ندارد. همچنین می‌توان مشاهده کرد که هرچند داده‌ها واقعی‌اند، اما کاملاً ایزوله بوده و تنها جابه‌جایی افراد را ثبت کرده‌اند.



به دلیل حجم زیاد داده‌ها، امکان نمایش تمام نقاط وجود ندارد. برای ارائه‌ی یک تصویر ذهنی از نحوهٔ حرکت، مسیر یک فرد را انتخاب و استخراج می‌کنیم. در کد زیر، مسیر اولین فرد موجود در دیتاست انتخاب شده است:
```python
# استخراج داده‌های مربوط به یک فرد (اولین uid موجود در دیتاست)
df1 = df[df['uid']==df['uid'].iloc[0]].copy()



```

این کار به ما اجازه می‌دهد الگوی حرکت یک فرد نمونه را مصورسازی کنیم و درک اولیه‌ای از داده‌ها به دست آوریم.




کتابخانه‌ی Matplotlib برای رسم نمودارها وارد می‌شود.

```python
import matplotlib.pyplot as plt
```

یک نمودار نقطه‌ای رسم می‌کند که در آن:

•	محور x مختصات افقی فرد است

•	محور y مختصات عمودی فرد است

هر نقطه نشان‌دهنده یک موقعیت مکانی ثبت‌شده در یک زمان مشخص است.

```python
plt.scatter(df1['x'], df1['y'] )
plt.show()
```


برای واضح‌تر شدن نمایش مسیر و جلوگیری از هم‌پوشانی زیاد نقاط، می‌توانیم از پارامتر alpha استفاده کنیم. این پارامتر میزان شفافیت نقاط را مشخص می‌کند و باعث می‌شود تراکم نقاط بهتر دیده شود.

```python
plt.scatter(df1['x'], df1['y'], alpha=0.5 )
plt.show()
```


برای ایجاد یک زمان واقعی در داده‌ها، ابتدا نیاز داریم یک نقطه شروع زمانی (Epoch Timestamp) تعیین کنیم. برای این کار می‌توانیم از ابزارهای آنلاین Timestamp Converter استفاده کنیم. در این ابزار:

1.	یک تاریخ انسانی (Human-Readable Date) وارد می‌کنیم.

2.	گزینه Human date → Timestamp را انتخاب می‌کنیم.

3.	نوع خروجی را روی ثانیه قرار می‌دهیم.

برای محاسبه زمان نهایی:
```python
df1['time']= Epoch timestamp + df1['d']*24*60*60 + df1['t']*30*60
```

حالا ما ستونی به اسم تایم داریم که با استفاده از این کد ستون time را که به‌صورت عددی و برحسب ثانیه بود، به یک تاریخ‌ـ‌زمان واقعی و قابل‌خواندن تبدیل می‌کند.
```python
df1['time'] = pd.to_datetime(df1['time'], unit='s')
```


برای شبیه‌سازی داده‌ها به مختصات واقعی، مختصات خام x و y را با یک مبدأ فرضی و ضریب مقیاس ترکیب می‌کنیم:
```python
E0 = 525000
N0 = 3945000

S = 100

df1['Easting'] = E0 + S*df1['x']
df1['Northing'] = N0 + S*df1['y']
```

با این محاسبه، مختصات ساده x و y به مختصات شبه‌واقعی Easting و Northing تبدیل می‌شوند که قابل استفاده در سیستم‌های نقشه‌ای هستند.

پس از تبدیل مختصات ساده x و y به مختصات شبه‌واقعی Easting و Northing، لازم است داده‌ها را به یک ساختار مکانی استاندارد تبدیل کنیم تا بتوان آن‌ها را در محیط‌های GIS مورد استفاده قرار داد. ابتدا با کمک کتابخانه Shapely برای هر رکورد یک شیء هندسی از نوع نقطه ایجاد می‌کنیم:
```python

from shapely.geometry import Point

geometry = [Point(xy) for xy in zip(df1['Easting'], df1['Northing'])]
```
در این مرحله، هر رکورد داده با استفاده از مختصات Easting و Northing به یک نقطهٔ هندسی تبدیل می‌شود. این نقاط امکان ساخت لایه مکانی را فراهم می‌کنند.

در گام بعد، با بهره‌گیری از GeoPandas داده‌ها را به یک GeoDataFrame تبدیل می‌کنیم:
```python

import geopandas as gpd
gdf = gpd.GeoDataFrame(df1, geometry=geometry, crs='EPSG:32639')
```

در این ساختار جدید، سیستم مختصات 'EPSG:32639' (UTM Zone 39N – WGS84) نیز تعریف می‌شود که برای موقعیت مکانی ایران مناسب است.

با انجام این مراحل، داده‌های اولیه به یک لایه مکانی کامل تبدیل شده‌اند که قابلیت نمایش بر روی نقشه، تحلیل‌های مکانی، ذخیره در قالب‌هایی مانند Shapefile یا GeoJSON  دارد

رای اطمینان از درست بودن فرایند تبدیل داده‌ها به لایه مکانی، می‌توانیم لایه ایجادشده را مستقیماً روی نقشه نمایش دهیم. دستور زیر یک نقشه تعاملی تولید می‌کند و نقاط را بر اساس مختصات آن‌ها نمایش می‌دهد:

```python
gdf.explore()
```
این نمایش تعاملی به ما کمک می‌کند مطمئن شویم که مختصات، سیستم مرجع مکانی (CRS) و تبدیل‌ها به‌درستی انجام شده‌اند.


برای استفاده از این قابلیت، لازم است بسته‌های زیر روی محیط پایتون نصب باشند:

•	Folium

برای ساخت نقشه تعاملی


•	Branca

برای مدیریت عناصر گرافیکی و رنگ‌ها در نقشه


•	Matplotlib

برای ترسیم نمودارها و پشتیبانی از عملیات گرافیکی


•	Mapclassify

برای طبقه‌بندی داده‌ها در نقشه‌های thematic


در گام بعد، برای نمایش بهتر و حرفه‌ای‌تر داده‌ها می‌توان از KeplerGL استفاده کرد. این ابزار یک کتابخانه قدرتمند برای مصورسازی داده‌های حجیم است و به‌طور ویژه برای نمایش مسیرهای حرکتی، نقاط مکانی و داده‌های با اندازه بزرگ طراحی شده است. استفاده از KeplerGL علاوه بر سرعت و کارایی بالا، امکان ایجاد نقشه‌های بسیار جذاب، تعاملی و قابل تنظیم را فراهم می‌کند.

KeplerGL به ما اجازه می‌دهد:

•	مسیرهای حرکتی افراد را در زمان نمایش دهیم،

•	نقاط، خطوط و الگوهای رفتاری را با رنگ‌بندی‌های مختلف مشاهده کنیم،


•	از قابلیت پخش زمانی (Time Playback) برای نمایش حرکت پویا استفاده کنیم،

•	و خروجی‌های بصری حرفه‌ای و قابل ارائه تولید کنیم.

به همین دلیل، پس از ایجاد GeoDataFrame و اطمینان از صحت مختصات، استفاده از KeplerGL یک انتخاب بسیار مناسب برای نمایش نهایی و تحلیل بصری داده‌های حرکتی محسوب می‌شود.

با اجرای این کد، یک نقشه خالی KeplerGL در محیط نوت‌بوک باز می‌شود و در مرحله بعد می‌توانیم داده خود را به آن اضافه کنیم و تنظیمات بصری مختلف را اعمال کنیم.
```python


from keplergl import KeplerGl
map_1 = KeplerGl()
```


KeplerGL تنها زمانی می‌تواند داده‌های ما را به‌درستی نمایش دهد که مختصات در سیستم WGS84 (EPSG:4326) باشند؛ یعنی مختصات به صورت Latitude و Longitude تعریف شده باشند. از آنجا که داده‌های ما در مرحله قبل در سیستم UTM ساخته شدند، لازم است پیش از اضافه‌کردن به KeplerGL آن‌ها را به EPSG:4326 تبدیل کنیم:

```python
#kepler config
#lan(EPSG:4326), lon(EPSG:4326), time

gdf = gdf.to_crs('EPSG:4326')
```



با اجرای این دستور، هندسه نقاط از سیستم مختصات UTM به مختصات جغرافیایی تبدیل می‌شود 

پس از تبدیل هندسه نقاط به سیستم مختصات WGS84، باید مقادیر longitude و latitude را به صورت ستون‌های جداگانه استخراج کنیم؛ زیرا KeplerGL برای نمایش داده‌ها به این دو ستون نیاز دارد. این کار با دسترسی به مختصات نقاط انجام می‌شود:

```python
gdf['lon'] = gdf.geometry.x
gdf['lat'] = gdf.geometry.y
```


در این مرحله:

•	ستون lon مختصات طول جغرافیایی را از جزء X هندسه برمی‌دارد

•	ستون lat مختصات عرض جغرافیایی را از جزء Y هندسه ذخیره می‌کند.

پس از استخراج ستون‌های lat و lon، لازم است داده‌ها را از حالت GeoDataFrame به یک DataFrame معمولی تبدیل کنیم؛ زیرا KeplerGL تنها با داده‌های جدولی بدون ستون geometry کار می‌کند. برای این منظور، ستون هندسه را حذف کرده و یک DataFrame جدید می‌سازیم:

```python
df4k = pd.DataFrame(gdf.drop(columns='geometry'))
```

در این مرحله ستون geometry حذف می‌شود،تمام اطلاعات مورد نیاز شامل زمان، شناسه فرد، مختصات طول و عرض جغرافیایی و سایر ویژگی‌ها حفظ می‌شوند و داده به فرمت مناسب برای بارگذاری در KeplerGL تبدیل می‌شود.


پس از تبدیل داده‌ها به DataFrame و استخراج ستون‌های مورد نیاز، اکنون می‌توانیم داده را مستقیماً وارد نقشه KeplerGL کنیم. این کار با دستور زیر انجام می‌شود:

```python
map_1.add_data(data=df4k, name='Peorson 0 Movments')
```
  



پس از اضافه‌کردن داده‌ها به KeplerGL، تمام تنظیمات ظاهری و تحلیلی نقشه را می‌توان به‌صورت تعاملی و بدون نوشتن حتی یک خط کد انجام داد. KeplerGL یک رابط کاربری بسیار قدرتمند دارد که امکان کنترل کامل لایه‌ها، فیلترها و نحوه‌ی نمایش داده‌های حرکتی را فراهم می‌کند.

۱. تنظیمات بخش Layers

در پنل Layers می‌توان:

•	رنگ نقاط یا خطوط،

•	اندازه آن‌ها،

•	نوع نمایش (نقطه، خط، Heatmap و …)،

•	و شفافیت یا مرزبندی

را به‌راحتی تغییر داد. این تغییرات به شما کمک می‌کنند الگوهای حرکتی را واضح‌تر و قابل‌درک‌تر نمایش دهید.

۲. ایجاد فیلتر زمانی در بخش Filters

در بخش Filters امکان افزودن فیلتر زمان وجود دارد. با انتخاب ستون زمان (time)، KeplerGL به‌طور خودکار قابلیت:

•	پخش حرکتی (Time Playback)

•	نمایش گام‌به‌گام مسیر افراد


•	و محدود کردن بازه زمانی نمایش داده‌ها

را در اختیار شما قرار می‌دهد.

این امکانات باعث می‌شوند داده‌های حرکتی به‌صورت یک انیمیشن تعاملی و قابل تحلیل در نقشه نمایش داده شوند.

تمام اين مراحل براي نمايش بر روي يک شخص بود در ادامه بايد آن را بتوانيم بر روي کل داده ها پياده کنيم






